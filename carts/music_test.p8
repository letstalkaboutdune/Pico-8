pico-8 cartridge // http://www.pico-8.com
version 32
__lua__
--initialize
--pattern ticks: track 1=(14*32)=448, track 2=(15*24)=360
--track maps
pattern1 = {0, 4, 8, 12}
loop1 = {4, 3, 2, 1}
pattern2 = {50, 52, 54, 56}
loop2 = {1, 2, 3, 4}
--track indices
track = 1
ticks = 0
ipattern = 1
iloop= 1
next = false
stat26 = 0

function updateticks() --checks if pattern is about to end
 if stat(26) >= (ticks-5) then --not working consistently
  next = true
  stat26 = stat(26)
 end
end

function updatenext()
 if next == true then
  iloop += iloop --increment loop index
  --STOPPED HERE
  --check current loop index against current track/pattern/loop
 end
end

function starttrack(id)
 if id == 1 then
  --play track 1
  track = 1
  ticks = 448
  music(pattern1[ipattern])
 elseif id == 2 then
  --play track 2
  track = 2
  ticks = 360
  music(pattern2[ipattern])
 end
end

function clearindex()
 isong = 1
 ipattern = 1
 iloopt = 1
 next = false
 stat26 = 0
end

function updatemusic()
 if btnp(0) then
  clearindex()
  starttrack(1)
 elseif btnp(1) then
  clearindex()
  starttrack(2)
 elseif btnp(3) then
  clearindex()
  music(-1,100) --stop music
 end
end

function _update()
 updateticks()
 updatenext()
 updatemusic()
end

function _draw()
 --clear screen
 rectfill (0,0,128,128,0)
 --print text
 print("\141\141 music test \141\141", 12, 0, 15)
 print("\144\144\144\144\144\144\144\144\144\144")
 print("press \139 for track 1")
 print("press \145 for track 2")
 print("press \131 to stop")
 print("\ndebug display")
 print("\144\144\144\144\144\144\144\144\144\144")
 print("stat(24)= "..stat(24))
 print("stat(26)= "..stat(26))
 print("ticks= "..ticks)
 print("next= "..tostring(next))
 print("stat26= "..stat26)
end

__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
370e00000b0730b0450b0450b0450b0730b0450b045107750b0730b0450b0450b0450b0730b0451c7450b0450b0730b0450b0450b0450b0730b045177450b0450b0730b0450b0450b0450b0730b0450b04517745
4b0e00003f605016053f6253e61538600336053f625326053f605016053f6253f605386003f6153f625326053f605016053f6253e61538600006053f6253f6053f605016053f6253f60538600006053f6253f615
ad0e0000344053440534405123353040512335133353040533405334053340533405304051f3351d4051d405304052e405324052d405143051c335304052e40533405334051e3052e4051c3351e3350840508405
6f0e0000344053440534405123353040512335133353040533405334053340533405304051f3351d4051d405304052e405324052d405143051c335304052e40533405334051e3052e4051c3351e3350840508405
010a00003f6003e6003b600376002f6002860023600156000c6010360100601226011a601126010b601026012e60129601256011f6011a601156010f601096010060100601006010060100601006010060100601
010700002370423704237042370423700237002370023700247042470424704247040070000700007000070000700007000070000700007000070000700007000070000700007000070000700007000070000700
010700000060000601006010060100601006010060100601006010060100601006010060100601006010060100601006010060100601006010060105601096000b60010600126001a60020600296003060000000
011400000900000700007000070009000007000070000700090000070000700007000900000700007000070009000007000070000700090000070000700007000900000700007000070009000007000070000700
1d14000018742187421874218742187421874218742187421874218742187421874218742187421a7421b7421b7421b7421b7421b7421b7421b7421d7421f7421f7421f7421f7421f74222742227421f74214742
1d1400001474214742147421474214742147421474214742147421474214742147421474214742147421d7421d7421d7421d7421d7421d7421d7421d7421b7421b7421b7421b7421b7421b7421b7421b7421d742
1d1400001d7421d7421d7421d7421d7421d7421d7421d7421d7421d7421d7421d7421d7421d7421d7421b7421b7421b7421b7421b7421b7421b7421b7421d7421d7421d7421d7421d7421d7421d7421d7421f742
1d1400001f7421f7421f7421f7421f7421f7421f7421f7421f7421f7421f7421f7421f7421b7421b7421a7421a7421a7421a7421a7421a7421a7421a7421a7421a7421a7421a7421a7421a7421a7421a7421a742
011400000907300765007650076509073007650076500765090730076500765007650907300765007650076509073007650076500765090730076500765007650907300765007650076509073007650076500765
011400000907308765087650876509073087650876508765090730876508765087650907308765087650876509073087650876508765090730876508765087650907308765087650876509073087650876508765
011400000907305765057650576509073057650576505765090730576505765057650907305765057650576509073057650576505765090730576505765057650907305765057650576509073057650576505765
011400000907307765077650776509073077650776507765090730776507765077650907307765077650776509073077650776507765090730776507765077650907307765077650776509073077650776507765
031400003f6053f6153f6253f615386353f6153f6253f615326053f6153f6253f615386353f6153f6253f615346053f6153f6253f615386353f6153f6253f615117003f6153f6253f615386353f6153f6253f615
1d14000024722247222472224722247222472224722247222472224722247222472224722247222672227722277222772227722277222772227722297222b7222b7222b7222b7222b7222e7222e7222b72220722
1d140000207222072220722207222072220722207222072220722207222072220722207222072220722297222972229722297222972229722297222972227722277222772227722277222772227722277221d722
1d1400001d7221d7221d7221d7221d7221d7221d7221d7221d7221d7221d7221d7221d7221d7221d722277222772227722277222772227722277222772229722297222972229722297222972229722297222b722
1d1400002b7222b7222b7222b7222b7222b7222b7222b7222b7222b7222b7222b7222b7222c7222c7222b7222b7222b7222b7222b7222b7222b7222b7222b7222b7222b7222b7222b7222b7222b7222b7222b722
1b1400003b6213662131621296211f62113621006010060100601006010670105701017010070100701007010070100701007010070100701007010070110741117411374115741187411a7411c7412074123741
2f1400001b7321b7321b7321b7321b7321b7321b7321b7321b7321b7321b7321b7321b7321b7321d7321f7321f7321f7321f7321f7321f7321f73220732227322273222732227322273227732277322573218732
2d14000018732187321873218732187321873218732187321873218732187321873218732187321873220732207322073220732207322073220732207321f7321f7321f7321f7321f7321f7321f7321f73218732
2d1400001873218732187321873218732187321873218732187321873218732187321873218732187322073220732207322073220732207322073220732227322273222732227322273222732227322273224732
2d1400002473224732247322473224732247322473224732247322473224732247322473220732207321f7321f7321f7322b7221f7322b7221f7321f7322b7221f7321f7322b7221f7322b7221f7321f7321f732
1d1400001474214742147421474214742147421474214742147421474214742147421474214742147421d7421d7421d7421d7421d7421d7421d7421d7421b7421b7421b7421b7421b7421b7421b7421b74211742
1d1400001174211742117421174211742117421174211742117421174211742117421174211742117421b7421b7421b7421b7421b7421b7421b7421b7421d7421d7421d7421d7421d7421d7421d7421d7421f742
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
31160000130551505516055180551a0551b0551e0551f05522055210551f0551b0551a055180551605515055130551505516055180551a0551b0551e0551f05522055210551f0551b0551a055180551605515055
2d1600000757207572075720757507572075720757507572075720757207572075750557205572055720357203572035750357203575035720357203575035720357203572035720357502572025720257200571
451600000057200572005720057500572005720057500572005720057200572005750057200572005720a5710a5720a5720a5720a5720a5720a5720a5720a5720957209572095720957209572095720957209572
25160000070733f6003e0153e015070733d0053c0153c015070733e0053e0153e015070733c0153c0003c015070733e0053e0153e015070733d0053c0153c015070733e0053e0153e015070733c0153c0003c015
131600003f6253f6043f6143f6203f6153f6043f6143f6213f615000003f6143f6203f615000003f6143f6213f615000003f6113f6203f615000003f6143f6213f615000003f6143f6203f615000003f6143f621
010f00000c0730000000000000002263500000000000c0000c000000000c07300000226350000000000000000c073000000000000000226352d600000000c0000c000000000c07300000226350c0730000000000
970f00003f6153f6003f615000003f6153f6003f615000003f6153f6153f6153f6003f6153f6003f6153f6153f6153f6003f6153f6003f6153f6153f6153f6003f6153f6003f6153f6003f6153f6003f6153f615
530f00000b300013000433504300043000433508300043350030000300033351033500300003000e335003000e3350e3000030000300043350433500300043350030000300003350030000300043350030005335
810f000023530195301c5301f530205322053220532205320050000500005000050023500195001c5001f50023500195001c5001f500005000050000500005000050000500005000050023500195001c5001f500
010f000023545195451c5451f5452054520545205002054520500005001e5451e5451e545195001c5451f5001c545195001c5001f5001a5451a5451a5001a5450050000500195451a500235001a5451c5001c545
010f00000c0000000000000000002263500000000000c0000c000000000c00000000226350000000000000000c000000000000000000226352d600000000c0000c000000000c00000000226350c0000000000000
010f00000c0730000000000000002263500000000000c0000c000000000c07300000226350000000000000000c000000000000000000236002d600000000c0000c000000000c00000000236350c0530c07300000
010f18000f0733e6053e6050f0733e6053e6050f0733e6050b0430f0730b0030b0030f0733e6053e6050f0733e6053e6050f0733e6050b0430f0730b0000b0000000300003000030000300003000030000300003
010f18000f0733e6053e6050f0733e6053e6050f0733e6050b0430f0730b0030b0030f0733e6053e6050f0733e6053e6050f0733e6050b0430f0730b0430b0430000000000000000000000000000000000000000
011000000f0003e6003e6000f0003e6003e6000f0003e6000b0000f0000b0000b0000f0003e6003e6000f0003e6003e6000f0003e6000b0000f0000b0000b0000000000000000000000000000000000000000000
110f18000604006040060450604006040060450604006040060450604006040090400604006040060450604006040060450404004040040450404004040050400000500005000050000500005000050000500005
110f18000b0400b0400b0450b0400b0400b0450b0400b0400b0450b0400b0400e0400b0400b0400b0450b0400b0400b04509040090400904509045090450a0400000000000000000000000000000000000000000
0d0f18001e0252102523025210251e025210251e025240251e0251c0251e025210251e0251c025250251e0251c025230251e025210251c025190251c025210250000500005000050000500005000050000500005
150f18001e0252102523025210251e025210251e025240251e0251c0251e025210251e0251c025250251e0251c025230251e025210251c025190251c025210252400000000000000000000000000000000000000
090f18003f6033f6033f603216233f6033f6033f6033f6033f603216233f6033f6033f6033f6033f603216233f6033f6033f6033f60322603216233f6033f6033560300603006030060300603006030060300603
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0b0600000c6600c6600c6600c66005600056000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
010800002f07500005000050000500005000050000500005000050000500005000050000500005000050000500005000050000500005000050000500005000050000500005000050000500005000050000500005
3d0b000032055370753c0000050000500005000050000500005000050000500005000050000500005000050000500005000050000500005000050000500005000050000500005000050000500005000050000500
3912000028052280521b0511005110052100521005210002110001100011000110001100011000110001100011000110001100000002000020000200002000020000200002000020000200002000020000200002
0b0600003c6213c6213c6213c6213c6213c6013c6013c601000000000100001000010000100001000010000100001000010000100001000010000100001000010000100001000010000100001000010000100001
07100000241432d1030a1032710300103001030010300103001030010300103001030010300103001030010300103001030010300103001030010300103001030010300103001030010300103001030010300103
331000003b6713667131671296711f671136710060100601000000000000000000000000000000000000000000000000000000000000000000000000000000000c00000000000000000000000000000000000000
070e000000600006000060000600006000060000600006000060000600006000060000600006000060001600056200562006620086200a6200d6200f6201262014621186211c62121621266212c6213162137621
230600003f651356512d6511e65111651056011660109601006000160000600006000060000600006000060000600006000060000600006000060000600006000060000600006000060000600006000060000600
__music__
04 0041427d
04 00404344
04 00424344
04 00424144
04 00014140
04 00014140
04 00014140
04 00014140
04 00010244
04 00010244
04 00010244
04 0001027e
04 00010344
04 00010344
04 00010344
04 00010344
01 0c081044
00 0d1a1044
00 0e1b1044
00 0f0b1015
00 0c081016
00 0d091017
00 0e0a1018
02 0f0b1019
01 20232463
00 20232163
00 20232261
00 20232162
02 20232261
00 60636262
00 60626463
02 60626463
01 25266768
00 25266768
00 25262769
00 25262769
00 25262769
00 2a262769
00 25262728
00 25262728
00 25262728
00 2b262728
00 25262729
00 25262729
00 25262729
00 2a262729
00 25262729
00 25262729
00 25262729
02 2a262729
04 2c2f7373
04 2d2f7373
04 2d307344
04 2d307344
04 2c2f3173
04 2d2f3173
04 2d303144
04 2d303144
04 2c2f3332
04 2d2f3332
04 2d303332
04 2c303332
04 2c2f3373
04 2d2f3373
